// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common_func.emevd\u0000N:\\GR\\data\\Param\\event\\common_macro.emevd\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0,82]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    InitializeCommonEvent(0, 9005810, 28000800, 28000000, 28000950, 28001950, 1084227584);
    RegisterBonfire(28000001, 28001951, 0, 0, 0, 5);
    RegisterBonfire(28000002, 28001952, 0, 0, 0, 5);
    RegisterBonfire(28000003, 28001953, 0, 0, 0, 5);
    InitializeEvent(0, 28000800, 0);
    InitializeEvent(0, 28002810, 0);
    InitializeEvent(0, 28002811, 0);
    InitializeEvent(0, 28002849, 0);
    InitializeEvent(0, 28002814, 0);
    InitializeEvent(0, 28002816, 0);
    InitializeEvent(0, 28002820, 0);
    InitializeEvent(0, 28002821, 0);
    InitializeEvent(0, 28002822, 0);
    InitializeEvent(0, 28002823, 0);
    InitializeCommonEvent(0, 90005200, 28000310, 30000, 20000, 28002310, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005260, 28000200, 28002203, 1091567616, 0, 0);
    InitializeCommonEvent(0, 90005260, 28000201, 28002203, 1091567616, 0, 0);
    InitializeCommonEvent(0, 90005260, 28000202, 28002203, 1091567616, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000203, 28002203, 0, 0);
    InitializeCommonEvent(0, 90005251, 28000205, 1092616192, 0, 0);
    InitializeCommonEvent(0, 90005221, 28000204, 30001, 20001, 0, 0);
    InitializeCommonEvent(0, 90005221, 28000207, 30000, 20000, 0, 0);
    InitializeEvent(1, 28002280, 28000281, 28002289, 1067030938, 0, 1065353216);
    InitializeEvent(2, 28002280, 28000282, 28002289, 1060320051, 0, 1077936128);
    InitializeEvent(3, 28002280, 28000283, 28002289, 1056964608, 0, 1092616192);
    InitializeEvent(4, 28002280, 28000284, 28002289, 1065353216, 0, 1092616192);
    InitializeEvent(5, 28002280, 28000285, 28002289, 1071225242, 0, 1088421888);
    InitializeEvent(6, 28002280, 28000286, 28002289, 1067869798, 0, 1069547520);
    InitializeEvent(7, 28002280, 28000287, 28002289, 1065353216, 0, 0);
    InitializeEvent(9, 28002280, 28000380, 28002289, 1056964608, 0, 1082130432);
    InitializeCommonEvent(0, 90005250, 28000210, 28002210, 1068708659, 0);
    InitializeCommonEvent(0, 90005250, 28000211, 28002210, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000212, 28002210, 1060320051, 0);
    InitializeCommonEvent(0, 90005250, 28000216, 28002216, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000217, 28002216, 1060320051, 0);
    InitializeCommonEvent(0, 90005250, 28000215, 28002215, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000214, 28002214, 0, 0);
    InitializeCommonEvent(0, 90005261, 28000229, 28002229, 1084227584, 0, 3010);
    InitializeEvent(0, 28002229, 0);
    InitializeCommonEvent(0, 90005250, 28000227, 28002227, 0, 3001);
    InitializeCommonEvent(0, 90005200, 28000311, 30000, 20000, 28002311, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000220, 28002220, 0, 3003);
    InitializeCommonEvent(0, 90005211, 28000221, 30000, 20000, 28002221, 1082130432, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005200, 28000222, 30000, 20000, 28002222, 1050253722, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005200, 28000223, 30000, 20000, 28002222, 1069547520, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000224, 28002222, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000350, 28002350, 1065353216, 0);
    InitializeCommonEvent(0, 90005250, 28000351, 28002351, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000354, 28002354, 0, 0);
    InitializeEvent(0, 28002355, 28000355, 1086324736, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000390, 28002390, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000358, 28002358, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000360, 28002360, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000361, 28002361, 0, 0);
    InitializeCommonEvent(0, 90005250, 28000362, 28002360, 0, 0);
    InitializeEvent(0, 28002580, 0);
    InitializeCommonEvent(0, 90005520, 28000589, 28001588, 28000588, 28000859);
    InitializeEvent(0, 28002498, 0);
    InitializeCommonEvent(0, 90005525, 28000610, 28001610);
    InitializeCommonEvent(1, 90005525, 28000611, 28001611);
    InitializeCommonEvent(0, 90005540, 28008500, 28001500, 28001501, 28003500, 464009, 12, 20);
    InitializeCommonEvent(1, 90005540, 28008502, 28001502, 28001503, 28003502, 464009, 12, 20);
    InitializeCommonEvent(0, 90005515, 28008541, 28001541);
    InitializeEvent(0, 28000700, 28000800, 28000801, 28000800, 1122369536);
    InitializeEvent(0, 28000701, 28000800, 28002700, 1073741824, 28002706, 28002707, 1075838976, 28002705, 28002701, 28002801, 28002709, 28002708);
    InitializeEvent(0, 28000702, 28000800, 28009210, 28002700, 28002702);
    InitializeEvent(1, 28000702, 28000800, 28009211, 28002701, 28002703);
    InitializeEvent(2, 28000702, 28000800, 28009212, 28002702, 28002704);
    InitializeCommonEvent(0, 90005706, 28000700, 30020, 0);
    InitializeCommonEvent(0, 90005706, 28000701, 30021, 0);
});

$Event(28002580, Default, function() {
    RegisterLadder(28000580, 28000581, 28001580);
    RegisterLadder(28000582, 28000583, 28001582);
    RegisterLadder(28000584, 28000585, 28001584);
    RegisterLadder(28000586, 28000587, 28001586);
});

$Event(28002229, Default, function() {
    if (!ThisEventSlot()) {
        WaitFor(
            (CharacterType(10000, TargetType.Alive)
                || CharacterType(10000, TargetType.BluePhantom)
                || CharacterType(10000, TargetType.WhitePhantom))
                && InArea(10000, 28002228));
        SetNetworkconnectedThisEventSlot(ON);
    }
L0:
    ChangeCharacterPatrolBehavior(28000229, 28002399);
});

$Event(28002280, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4) {
    EndIf(ThisEventSlot());
    DisableCharacterAI(X0_4);
    SetSpEffect(X0_4, 8082);
    chrSp = (CharacterType(10000, TargetType.BlackPhantom) && CharacterHasSpEffect(10000, 3710))
        || CharacterType(10000, TargetType.Alive)
        || CharacterType(10000, TargetType.BluePhantom)
        || CharacterType(10000, TargetType.WhitePhantom);
    sp = CharacterHasSpEffect(X0_4, 481)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90110)
        && !CharacterHasSpEffect(X0_4, 90160);
    sp2 = CharacterHasSpEffect(X0_4, 482)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90120)
        && !CharacterHasSpEffect(X0_4, 90160)
        && !CharacterHasSpEffect(X0_4, 90162);
    sp3 = CharacterHasSpEffect(X0_4, 483)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90140)
        && !CharacterHasSpEffect(X0_4, 90160)
        && !CharacterHasSpEffect(X0_4, 90161);
    sp4 = CharacterHasSpEffect(X0_4, 484)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90130)
        && !CharacterHasSpEffect(X0_4, 90161)
        && !CharacterHasSpEffect(X0_4, 90162);
    sp5 = CharacterHasSpEffect(X0_4, 487)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90150)
        && !CharacterHasSpEffect(X0_4, 90160);
    areaChrSp = InArea(10000, X4_4) && chrSp;
    WaitFor(
        HasDamageType(X0_4, 0, DamageType.Unspecified)
            || CharacterHasStateInfo(X0_4, 436)
            || CharacterHasStateInfo(X0_4, 2)
            || CharacterHasStateInfo(X0_4, 5)
            || CharacterHasStateInfo(X0_4, 6)
            || CharacterHasStateInfo(X0_4, 260)
            || areaChrSp
            || sp
            || sp2
            || sp3
            || sp4
            || sp5);
    SetNetworkconnectedThisEventSlot(ON);
    if (areaChrSp.Passed) {
        WaitFixedTimeSeconds(X8_4);
        if (Signed(X12_4) != -1) {
            ForceAnimationPlayback(X0_4, X12_4, true, false, false);
        }
    }
L1:
    EnableCharacterAI(X0_4);
    WaitFixedTimeSeconds(X16_4);
    ClearSpEffect(X0_4, 8082);
});

$Event(28002355, Restart, function(X0_4, X4_4, X8_4, X12_4) {
    EndIf(ThisEventSlot());
    DisableCharacterAI(X0_4);
    chrSp = (CharacterType(10000, TargetType.BlackPhantom) && CharacterHasSpEffect(10000, 3710))
        || CharacterType(10000, TargetType.Alive)
        || CharacterType(10000, TargetType.BluePhantom)
        || CharacterType(10000, TargetType.WhitePhantom);
    sp = CharacterHasSpEffect(X0_4, 481)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90110)
        && !CharacterHasSpEffect(X0_4, 90160);
    sp2 = CharacterHasSpEffect(X0_4, 482)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90120)
        && !CharacterHasSpEffect(X0_4, 90160)
        && !CharacterHasSpEffect(X0_4, 90162);
    sp3 = CharacterHasSpEffect(X0_4, 483)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90140)
        && !CharacterHasSpEffect(X0_4, 90160)
        && !CharacterHasSpEffect(X0_4, 90161);
    sp4 = CharacterHasSpEffect(X0_4, 484)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90130)
        && !CharacterHasSpEffect(X0_4, 90161)
        && !CharacterHasSpEffect(X0_4, 90162);
    sp5 = CharacterHasSpEffect(X0_4, 487)
        && !CharacterHasSpEffect(X0_4, 90100)
        && !CharacterHasSpEffect(X0_4, 90150)
        && !CharacterHasSpEffect(X0_4, 90160);
    flagArea = EventFlag(28008500) || EntityInRadiusOfEntity(10000, X0_4, X4_4, 1);
    flagAreaChrSp = flagArea && chrSp;
    WaitFor(
        HasDamageType(X0_4, 0, DamageType.Unspecified)
            || CharacterHasStateInfo(X0_4, 436)
            || CharacterHasStateInfo(X0_4, 2)
            || CharacterHasStateInfo(X0_4, 5)
            || CharacterHasStateInfo(X0_4, 6)
            || CharacterHasStateInfo(X0_4, 260)
            || flagAreaChrSp
            || sp
            || sp2
            || sp3
            || sp4
            || sp5);
    SetNetworkconnectedThisEventSlot(ON);
    if (flagAreaChrSp.Passed) {
        WaitFixedTimeSeconds(X8_4);
        if (Signed(X12_4) != -1) {
            ForceAnimationPlayback(X0_4, X12_4, true, false, false);
        }
    }
L1:
    EnableCharacterAI(X0_4);
});

$Event(28002498, Restart, function() {
    if (!EventFlag(28000589)) {
        ModifyNavimeshConnectionBitflag(28002498, NavimeshType.Solid, BitopType.Add);
        WaitFor(EventFlag(28000589));
    }
L0:
    ModifyNavimeshConnectionBitflag(28002498, NavimeshType.Solid, BitopType.Delete);
    EndEvent();
});

$Event(28000800, Restart, function() {
    EndIf(EventFlag(28000800));
    WaitFor(CharacterHPValue(28000800) <= 0);
    WaitFixedTimeSeconds(4);
    PlaySE(28000800, SoundType.SFX, 888880000);
    WaitFor(CharacterDead(28000800));
    HandleBossDefeatAndDisplayBanner(28000800, TextBannerType.LegendFelled);
    //boss rewards (6 bonus items, DLC version)
InitializeCommonEvent(0,90001046,1049304301,1049304154,1049304158,1049307323,1049307324,1049307325,1049307326,1049307327,1049307328,1049307329,1049306639,1049306642,1049306644,1049306647,1049306652,1049306654,1049306656,1049300301);
    //roundtable warp
    WaitFixedTimeSeconds(6);
    WarpPlayer(11, 10, 0, 0, 11102021, 0);
});

$Event(28002810, Restart, function() {
    if (EventFlag(28000800)) {
        DisableCharacter(28005800);
        DisableCharacterCollision(28005800);
        ForceCharacterDeath(28005800, false);
        EndEvent();
    }
L0:
    if (!PlayerIsInOwnWorld() && EventFlag(28003811)) {
        EndEvent();
    }
L0:
    DisableCharacterAI(28005800);
    DisableCharacterGravity(28000800);
    DisableCharacterCollision(28000800);
    DisableCharacter(28000800);
    SetCharacterAIId(28000801, 500000003);
    DisableCharacterAI(28000801);
    EnableCharacterInvincibility(28000801);
    ForceAnimationPlayback(28000801, 30000, false, false, false);
    if (!EventFlag(28000801)) {
        WaitFor(EventFlag(28000814));
    } else {
L1:
        WaitFor(EventFlag(28002805) && InArea(10000, 28002800));
    }
L2:
    SetEventFlagID(28002700, ON);
    EnableCharacterAI(28000801);
    ForceAnimationPlayback(28000801, 20000, false, true, false);
    DisableCharacterInvincibility(28000801);
    ForceAnimationPlayback(28000801, 20, false, false, false);
    SetEventFlagID(28002708, ON);
    SetNetworkconnectedEventFlagID(28000801, ON);
});

$Event(28002811, Restart, function() {
    EndIf(EventFlag(28000800));
    if (!PlayerIsInOwnWorld() && EventFlag(28003811)) {
        DisableCharacter(28000801);
        DisableCharacterCollision(28000801);
        WarpCharacterAndCopyFloor(28000800, TargetEntityType.Area, 28002812, -1, 28000801);
        EnableCharacterGravity(28000800);
        EnableCharacterCollision(28000800);
        EnableCharacter(28000800);
        EnableCharacterAI(28000800);
        SetNetworkUpdateRate(28000800, true, CharacterUpdateFrequency.AlwaysUpdate);
        DisplayBossHealthBar(Enabled, 28000800, 0, 905051000);
        EndEvent();
    }
L0:
    SetSpEffect(28000100, 9531);
    WaitFor(CharacterHPValue(28000801) < 1);
    SetEventFlagID(28003811, ON);
    EnableCharacter(28000800);
    DisableCharacterCollision(28000801);
    WaitFixedTimeSeconds(5);
    if (PlayerIsInOwnWorld()) {
        PlayCutsceneToPlayerAndWarp(28000000, CutscenePlayMode.Skippable, 28002810, 28000000, 10000, 28000000, false);
    } else {
        PlayCutsceneToPlayer(28000000, CutscenePlayMode.Skippable, 10000);
    }
    WaitFixedTimeRealFrames(1);
    if (PlayerIsInOwnWorld()) {
        SetCameraAngle(8.26, 7.79);
    }
    SetEventFlagID(28002801, ON);
    SetEventFlagID(28002802, ON);
    DisableCharacter(28000801);
    WarpCharacterAndCopyFloor(28000800, TargetEntityType.Area, 28002812, -1, 28000801);
    EnableCharacterGravity(28000800);
    EnableCharacterCollision(28000800);
    WaitFixedTimeRealFrames(1);
    ForceAnimationPlayback(28000800, 20000, false, false, false);
    EnableCharacterAI(28000800);
    SetNetworkUpdateRate(28000800, true, CharacterUpdateFrequency.AlwaysUpdate);
    DisplayBossHealthBar(Enabled, 28000800, 0, 905051000);
    SetSpEffect(28000100, 9532);
});

$Event(28002814, Restart, function() {
    EndIf(EventFlag(28000800));
    EndIf(EventFlag(28000801));
    SetEventFlagID(28000814, OFF);
    WaitFor(InArea(10000, 28002814));
    SetEventFlagID(28000814, ON);
});

$Event(28002815, Restart, function(X0_4, X4_4, X8_4) {
    DisableNetworkSync();
    DisableAsset(X4_4);
    DeleteAssetfollowingSFX(X4_4, true);
    WaitFor(
        ((CharacterType(10000, TargetType.BlackPhantom)
            || CharacterType(10000, TargetType.Invader)
            || CharacterType(10000, TargetType.Invader2)
            || CharacterType(10000, TargetType.Invader3))
            && !EventFlag(X0_4))
            || ((CharacterType(10000, TargetType.WhitePhantom)
                || CharacterType(10000, TargetType.BluePhantom))
                && !EventFlag(X0_4))
            || ((EventFlag(28000814) || EventFlag(28000801)) && !EventFlag(X0_4))
            || ((HasMultiplayerState(MultiplayerState.Invasion)
                || HasMultiplayerState(MultiplayerState.InvasionPending))
                && EventFlag(X0_4)
                && !CharacterType(10000, TargetType.WhitePhantom))
            || ((HasMultiplayerState(MultiplayerState.Invasion)
                || HasMultiplayerState(MultiplayerState.InvasionPending))
                && EventFlag(X0_4)
                && CharacterType(10000, TargetType.WhitePhantom)
                && !EntityInRadiusOfEntity(10000, X4_4, 1, 1)));
    EnableAsset(X4_4);
    DeleteAssetfollowingSFX(X4_4, true);
    CreateAssetfollowingSFX(X4_4, 101, X8_4);
    WaitFor(
        !((CharacterType(10000, TargetType.BlackPhantom)
            || CharacterType(10000, TargetType.Invader)
            || CharacterType(10000, TargetType.Invader2)
            || CharacterType(10000, TargetType.Invader3))
            && !EventFlag(X0_4))
            && !((CharacterType(10000, TargetType.WhitePhantom)
                || CharacterType(10000, TargetType.BluePhantom))
                && !EventFlag(X0_4))
            && !((EventFlag(28000814) || EventFlag(28000801)) && !EventFlag(X0_4))
            && !((HasMultiplayerState(MultiplayerState.Invasion)
                || HasMultiplayerState(MultiplayerState.InvasionPending))
                && EventFlag(X0_4)
                && !CharacterType(10000, TargetType.WhitePhantom))
            && !((HasMultiplayerState(MultiplayerState.Invasion)
                || HasMultiplayerState(MultiplayerState.InvasionPending))
                && EventFlag(X0_4)
                && CharacterType(10000, TargetType.WhitePhantom)
                && !EntityInRadiusOfEntity(10000, X4_4, 1, 1)));
    RestartEvent();
});

$Event(28002816, Restart, function() {
    EndIf(EventFlag(28000800));
    WaitFor(EventFlag(28002709));
    SetCharacterAIId(28000801, 50500000);
    EnableCharacterAI(28000801);
});

$Event(28002820, Restart, function() {
    EndIf(EventFlag(28000800));
    WaitFor(CharacterHasSpEffect(28000800, 20010269));
    SetEventFlagID(28002820, ON);
});

$Event(28002821, Restart, function() {
    DisableNetworkSync();
    EndIf(EventFlag(28000800));
    ChangeWeather(Weather.None, -1, false);
    WaitFor(InArea(10000, 28002821) && EventFlag(28002820));
    ChangeWeather(Weather.WindyPuffyClouds, -1, true);
    DeleteAssetfollowingSFX(28001821, true);
    CreateAssetfollowingSFX(28001821, 200, 828710);
    WaitFor(EventFlag(28000800));
    ChangeWeather(Weather.None, -1, false);
    DeleteAssetfollowingSFX(28001821, true);
});

$Event(28002822, Restart, function() {
    EndIf(EventFlag(28000800));
    dmg = HasDamageType(28000801, 0, DamageType.Unspecified);
    WaitFor(EventFlag(28002700) && (EventFlag(28002701) || dmg));
    if (dmg.Passed) {
        SetEventFlagID(28002705, ON);
    }
    SetEventFlagID(28002801, ON);
});

$Event(28002823, Restart, function() {
    EndIf(EventFlag(28000800));
    WaitFor(CharacterHasSpEffect(28000800, 20010298));
    SetEventFlagID(28002823, ON);
});

$Event(28002830, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4, X20_4, X24_4, X28_4) {
    DisableNetworkSync();
    if (EventFlag(X0_4)) {
        EndEvent();
    }
L0:
    if (PlayerIsInOwnWorld()) {
        SetEventFlagID(X8_4, OFF);
    }
    flag &= EventFlag(X8_4);
    if (!PlayerIsInOwnWorld()) {
        flag &= EventFlag(X12_4);
    }
    if (0 != X16_4) {
        flag &= EventFlag(X16_4);
    }
    WaitFor(flag);
    WaitFixedTimeFrames(1);
    if (!EventFlag(X20_4)) {
        hpFlag |= CharacterHPValue(28000801) <= 0;
    }
    hpFlag |= EventFlag(X20_4) || EventFlag(X0_4);
    WaitFor(hpFlag);
    SetBossBGM(X4_4, BossBGMState.Stop1);
    WaitFor(EventFlag(X20_4) || EventFlag(X0_4));
    if (!EventFlag(X0_4)) {
        WaitFixedTimeFrames(1);
        if (Signed(X24_4) != 0) {
        }
        SetBossBGM(X4_4, BossBGMState.HeatUp);
        WaitFor(EventFlag(28002823) || EventFlag(X0_4));
        if (!EventFlag(X0_4)) {
            SetBossBGM(X4_4, BossBGMState.HeatUp2);
            WaitFor(EventFlag(X0_4));
        }
    }
L1:
    if (Signed(X28_4) != 1) {
        SetBossBGM(X4_4, BossBGMState.Stop2);
        EndEvent();
    }
    SetBossBGM(X4_4, BossBGMState.Stop1);
});

$Event(28002849, Restart, function() {
    InitializeCommonEvent(0, 9005800, 28000800, 28001800, 28002800, 28002805, 28005800, 10000, 28000801, 28002801);
    InitializeCommonEvent(0, 9005801, 28000800, 28001800, 28002800, 28002805, 28002806, 10000);
    InitializeEvent(0, 28002815, 28000800, 28001800, 3);
    InitializeEvent(0, 28002830, 28000800, 505000, 28002805, 28002806, 28002801, 28002802, 1, 0);
});

$Event(28000700, Restart, function(X0_4, X4_4, X8_4, X12_4) {
    EndIf(!PlayerIsInOwnWorld());
    EndIf(EventFlag(X0_4));
    SetCharacterTalkRange(X4_4, X12_4);
    if (0 != X8_4) {
        SetCharacterTalkRange(X8_4, X12_4);
    }
    EndEvent();
});

$Event(28000701, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4, X20_4, X24_4, X28_4, X32_4, X36_4, X40_4) {
    EndIf(!PlayerIsInOwnWorld());
    EndIf(EventFlag(X0_4));
    GotoIf(L0, !EventFlag(X12_4));
    Goto(L1);
L0:
    WaitFor(EventFlag(X4_4));
    WaitFixedTimeSeconds(X8_4);
    SetEventFlagID(X12_4, ON);
    RestartEvent();
L1:
    WaitFor(EventFlag(X16_4));
    WaitFor(
        ElapsedSeconds(X20_4) || (EventFlag(X40_4) && InArea(20000, X32_4)) || EventFlag(X24_4));
    SetNetworkconnectedEventFlagID(X36_4, ON);
    EndIf(EventFlag(X24_4));
    SetEventFlagID(X28_4, ON);
    EndEvent();
});

$Event(28000702, Restart, function(X0_4, X4_4, X8_4, X12_4) {
    EndIf(EventFlag(X0_4));
    EndIf(EventFlag(X4_4));
    EndIf(!PlayerIsInOwnWorld());
    WaitFor(InArea(20000, X8_4) || EventFlag(X0_4) || EventFlag(X4_4) || EventFlag(X12_4));
    EndIf(EventFlag(X0_4));
    EndIf(EventFlag(X4_4));
    EndIf(EventFlag(X12_4));
    SetEventFlagID(X12_4, ON);
    EndEvent();
});
