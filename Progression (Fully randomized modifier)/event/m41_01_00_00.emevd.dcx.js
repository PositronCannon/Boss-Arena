// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common_func.emevd\u0000N:\\GR\\data\\Param\\event\\common_macro.emevd\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0,82]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    InitializeCommonEvent(0, 90005646, 41010800, 41012840, 41012841, 41011840, 41012840, 297);
    InitializeCommonEvent(0, 900005610, 41011500, 100, 800, 0);
    RegisterBonfire(41010000, 41011950, 0, 0, 0, 8);
    InitializeEvent(0, 41012800, 0);
    InitializeEvent(0, 41012810, 0);
    InitializeEvent(0, 41012811, 0);
    InitializeEvent(0, 41012849, 0);
    InitializeEvent(0, 41012610, 0);
    InitializeEvent(0, 41012612, 0);
    InitializeCommonEvent(0, 90005511, 41018560, 41011560, 41013560, 449009, 0);
    InitializeCommonEvent(0, 90005512, 41018560, 41012560, 41012561);
    InitializeCommonEvent(0, 90005511, 41018562, 41011562, 41013562, 449009, 0);
    InitializeCommonEvent(0, 90005512, 41018562, 41012562, 41012563);
    InitializeEvent(0, 41012580, 0);
    InitializeEvent(0, 41012570, 0, 41011510);
});

$Event(50, Default, function() {
    InitializeCommonEvent(0, 90005221, 41010201, 30001, 20001, 0, 0);
    InitializeCommonEvent(0, 90005221, 41010202, 30000, 20000, 0, 0);
    InitializeCommonEvent(0, 90005271, 41010203, 0, -1);
    InitializeEvent(1, 41012570, 41010203, 41011203);
    InitializeCommonEvent(0, 90005261, 41010204, 41012204, 1077936128, 0, 3003);
    InitializeCommonEvent(0, 90005261, 41010205, 41012205, 1073741824, 1056964608, 3001);
    InitializeCommonEvent(0, 90005261, 41010206, 41012205, 1073741824, 0, 3001);
    InitializeCommonEvent(0, 90005261, 41010207, 41012205, 1073741824, 1056964608, 3003);
    InitializeCommonEvent(0, 90005221, 41010208, 30001, 20001, 0, 0);
    InitializeCommonEvent(0, 90005221, 41010210, 30002, 20002, 0, 0);
    InitializeCommonEvent(0, 90005221, 41010213, 30001, 20001, 0, 0);
    InitializeCommonEvent(0, 90005221, 41010212, 30000, 20000, 0, 0);
    InitializeCommonEvent(0, 90005250, 41010211, 41012211, 0, -1);
    InitializeCommonEvent(0, 90005250, 41010214, 41012211, 0, -1);
    InitializeCommonEvent(0, 90005250, 41010215, 41012215, 0, 3003);
    InitializeCommonEvent(0, 90005221, 41010217, 30001, 20001, 0, 0);
    InitializeCommonEvent(0, 90005221, 41010218, 30000, 20000, 0, 0);
    InitializeCommonEvent(0, 90005261, 41010220, 41012220, 1073741824, 0, -1);
    InitializeCommonEvent(0, 90005221, 41010221, 30001, 20001, 0, 0);
    InitializeCommonEvent(0, 90005261, 41010225, 41012225, 1065353216, 1069547520, 3004);
    InitializeCommonEvent(0, 90005271, 41010231, 0, -1);
    InitializeEvent(2, 41012570, 41010231, 41011231);
    InitializeCommonEvent(0, 90005271, 41010233, 0, -1);
    InitializeEvent(3, 41012570, 41010233, 41011233);
    InitializeCommonEvent(0, 90005261, 41010235, 41012235, 1084227584, 0, -1);
    InitializeCommonEvent(0, 90005261, 41010236, 41012235, 1084227584, 0, -1);
    InitializeCommonEvent(0, 90005261, 41010330, 41012330, 1073741824, 0, -1);
    InitializeCommonEvent(0, 90005211, 41010331, 30002, 20002, 41012331, 1065353216, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010337, 30000, 20000, 41012337, 1065353216, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010300, 30000, 20000, 41012300, 0, 1056964608, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010301, 30000, 20000, 41012300, 0, 1069547520, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010302, 30000, 20000, 41012300, 0, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010303, 30000, 20000, 41012300, 0, 1073741824, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010305, 30000, 20000, 41012300, 0, 1065353216, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010306, 30000, 20000, 41012300, 0, 1056964608, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010307, 30000, 20000, 41012300, 0, 1069547520, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010312, 30000, 20000, 41012308, 0, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010313, 30000, 20000, 41012308, 0, 1045220557, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010314, 30000, 20000, 41012308, 0, 1069547520, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010318, 30000, 20000, 41012318, 0, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 41010251, 30000, 20000, 41012251, 1084227584, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005445, 41010252, 30002, 20002, 41012252, 1050253722, 0, 0, 0, 0, 41011252);
    InitializeCommonEvent(0, 90005261, 41010253, 41012253, 1084227584, 0, -1);
    InitializeCommonEvent(0, 90005446, 41010254, 30002, 20002, 1090519040, 0, 0, 0, 0, 0, 41011254);
    InitializeCommonEvent(0, 90005445, 41010255, 30004, 20004, 41012255, 1056964608, 0, 0, 0, 0, 41011255);
    InitializeCommonEvent(0, 90005445, 41010256, 30004, 20004, 41012256, 0, 0, 0, 0, 0, 41011256);
    InitializeCommonEvent(0, 90005211, 41010257, 30000, 20000, 41012257, 1073741824, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005261, 41010258, 41012258, 1073741824, 0, -1);
    InitializeCommonEvent(0, 90005261, 41010259, 41012259, 1073741824, 0, 3003);
    InitializeCommonEvent(0, 90005445, 41010263, 30004, 20004, 41012264, 1067030938, 0, 0, 0, 0, 41011263);
    InitializeCommonEvent(0, 90005445, 41010264, 30002, 20002, 41012264, 0, 0, 0, 0, 0, 41011264);
    InitializeCommonEvent(0, 90005261, 41010267, 41012267, 1073741824, 0, 3003);
    InitializeCommonEvent(0, 90005261, 41010270, 41012270, 1073741824, 0, 3001);
    InitializeCommonEvent(0, 90005261, 41010350, 41012350, 1073741824, 0, -1);
    InitializeCommonEvent(0, 90005261, 41010351, 41012351, 1073741824, 0, -1);
    InitializeCommonEvent(0, 90005261, 41010352, 41012351, 1073741824, 1056964608, -1);
    InitializeCommonEvent(0, 90005261, 41010360, 41012351, 1073741824, 1075838976, -1);
});

$Event(41012580, Default, function() {
    RegisterLadder(41010580, 41010581, 41011580);
});

$Event(41012550, Restart, function(X0_4, X4_4) {
    EndIf(ThisEventSlot());
    EnableAssetInvunerability(X4_4);
    WaitFor(SpecialStandbyEndedFlag(X0_4));
    DisableAssetInvunerability(X4_4);
    RequestAssetDestruction(X4_4, 1);
});

$Event(41012570, Restart, function(X0_4, X4_4) {
    EndIf(ThisEventSlot());
    if (AssetDestroyed(X4_4, Equal, 1)) {
        WaitFor(CharacterHasSpEffect(X0_4, 9624));
        ForceAnimationPlayback(X0_4, 0, false, false, false);
        EnableCharacterAI(X0_4);
        EndEvent();
    }
    EnableAssetInvunerability(X4_4);
    EndIf(X0_4 == 0);
    WaitFor(CharacterHasSpEffect(X0_4, 9624));
    WaitFor(SpecialStandbyEndedFlag(X0_4) || !CharacterHasSpEffect(X0_4, 9624));
    DisableAssetInvunerability(X4_4);
});

$Event(41012800, Restart, function() {
    EndIf(EventFlag(41010800));
    WaitFor(CharacterHPValue(41010800) <= 0);
    WaitFixedTimeSeconds(4);
    PlaySE(41010800, SoundType.SFX, 888880000);
    WaitFor(CharacterDead(41010800));
    HandleBossDefeatAndDisplayBanner(41010800, TextBannerType.EnemyFelled);
    //boss rewards (4 bonus items + guaranteed flag)
    InitializeCommonEvent(0,90001034,1049304265,-1,-1,1049304152,1049307160,1049307161,1049307162,1049307163,1049307164,1049306202,1049306204,1049306206,1049306209,1049306214,1049300265);
    //roundtable warp
    WaitFixedTimeSeconds(6);
    WarpPlayer(11, 10, 0, 0, 11102021, 0);
});

$Event(41012810, Restart, function() {
    if (EventFlag(41010800)) {
        DisableCharacter(41010800);
        DisableCharacterCollision(41010800);
        ForceCharacterDeath(41010800, false);
        EndEvent();
    }
L0:
    DisableCharacterAI(41010800);
    WaitFor(EventFlag(41012805) && InArea(10000, 41012800));
L2:
    EnableCharacterAI(41010800);
    SetNetworkUpdateRate(41010800, true, CharacterUpdateFrequency.AlwaysUpdate);
    DisplayBossHealthBar(Enabled, 41010800, 0, 905040400);
});

$Event(41012811, Restart, function() {
    EndIf(EventFlag(41010800));
    WaitFor(HPRatio(41010800) <= 0.6);
    SetEventFlagID(41012802, ON);
});

$Event(41012849, Restart, function() {
    InitializeCommonEvent(0, 9005800, 41010800, 41011800, 41012800, 41012805, 41015800, 10000, 0, 0);
    InitializeCommonEvent(0, 9005801, 41010800, 41011800, 41012800, 41012805, 41012806, 10000);
    InitializeCommonEvent(0, 9005811, 41010800, 41011800, 4, 0);
    InitializeCommonEvent(0, 9005822, 41010800, 941000, 41012805, 41012806, 0, 41012802, 0, 0);
});

$Event(41012610, Restart, function() {
    ForceAnimationPlayback(41011600, 1000020, false, false, true);
    if (!EventFlag(41012601)) {
        WaitFor(InArea(10000, 41012600) || InArea(10000, 41012601) || EventFlag(41012601));
        if (MapHasPermissionToUpdate(false, 0, 0, 0, 0)) {
            SetNetworkconnectedEventFlagID(41012601, ON);
        }
        ForceAnimationPlayback(41011601, 1000000, false, false, true);
        ForceAnimationPlayback(41011600, 1000021, false, true, true);
        ForceAnimationPlayback(41011600, 1000012, false, true, true);
        WaitFor(
            (!AllPlayersInArea(41012600)
                && !AllPlayersInArea(41012601)
                && AssetBackread(41011600, Equal, 1))
                || !EventFlag(41012601));
        if (MapHasPermissionToUpdate(false, 0, 0, 0, 0)) {
            SetNetworkconnectedEventFlagID(41012601, OFF);
        }
        RestartEvent();
    }
L9:
    WaitFor(!EventFlag(41012601));
    RestartEvent();
});

$Event(41012612, Restart, function() {
    if (!EventFlag(41010610)) {
        ForceAnimationPlayback(41011602, 2000030, false, false, true);
    } else {
        ForceAnimationPlayback(41011602, 2000020, false, false, true);
    }
    if (!EventFlag(41012602)) {
        areaFlag = InArea(10000, 41012610) && !EventFlag(41010610);
        WaitFor(
            InArea(10000, 41012602) || InArea(10000, 41012603) || areaFlag || EventFlag(41012602));
        if (MapHasPermissionToUpdate(false, 0, 0, 0, 0)) {
            SetNetworkconnectedEventFlagID(41012602, ON);
        }
        if (!EventFlag(41010610)) {
            SetNetworkconnectedEventFlagID(41010610, ON);
            ForceAnimationPlayback(41011602, 2000032, false, true, true);
            GotoIf(S0, areaFlag.Passed);
        }
        ForceAnimationPlayback(41011603, 2000000, false, false, true);
        ForceAnimationPlayback(41011602, 2000021, false, true, true);
        ForceAnimationPlayback(41011602, 2000012, false, true, true);
        WaitFor(
            (!AllPlayersInArea(41012602)
                && !AllPlayersInArea(41012603)
                && AssetBackread(41011602, Equal, 1))
                || !EventFlag(41012602));
S0:
        if (MapHasPermissionToUpdate(false, 0, 0, 0, 0)) {
            SetNetworkconnectedEventFlagID(41012602, OFF);
        }
        RestartEvent();
    }
L9:
    WaitFor(!EventFlag(41012602));
    RestartEvent();
});
