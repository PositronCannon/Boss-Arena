// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common_func.emevd\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    InitializeCommonEvent(0, 90001001, 0);
    RegisterBonfire(73013, 30131950, 0, 0, 0, 5);
    InitializeCommonEvent(0, 90005250, 30130250, 30132250, 0, 0);
    InitializeCommonEvent(0, 90005200, 30130251, 30000, 20000, 30132251, 0, 0, 0, 0, 0);
    InitializeCommonEvent(2, 90005200, 30130253, 30000, 20000, 30132251, 1045220557, 0, 0, 0, 0);
    InitializeCommonEvent(3, 90005200, 30130254, 30000, 20000, 30132251, 1056964608, 0, 0, 0, 0);
    InitializeCommonEvent(4, 90005200, 30130255, 30000, 20000, 30132251, 1050253722, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005200, 30130256, 30000, 20000, 30132256, 1065353216, 0, 0, 0, 0);
    InitializeCommonEvent(1, 90005200, 30130257, 30000, 20000, 30132256, 1050253722, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005250, 30130270, 30132270, 0, 0);
    InitializeCommonEvent(1, 90005250, 30130271, 30132270, 0, 0);
    InitializeCommonEvent(1, 90005200, 30130275, 30000, 20000, 30132405, 1050253722, 0, 0, 0, 0);
    InitializeCommonEvent(2, 90005200, 30130276, 30000, 20000, 30132405, 1056964608, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005250, 30130297, 30132297, 1077936128, 0);
    InitializeCommonEvent(0, 90005221, 30130289, 30000, 20000, 0, 0);
    InitializeCommonEvent(1, 90005221, 30130290, 30000, 20000, 0, 0);
    InitializeCommonEvent(0, 90005200, 30130400, 30000, 20000, 30132400, 0, 0, 0, 0, 0);
    InitializeCommonEvent(2, 90005200, 30130402, 30000, 20000, 30132400, 1056964608, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005201, 30130407, 30000, 20000, 1084227584, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005200, 30130408, 30000, 20000, 30132408, 1065353216, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005250, 30130300, 30132300, 0, 3006);
    InitializeCommonEvent(0, 90005200, 30130301, 30000, 20000, 30132301, 1045220557, 0, 0, 0, 0);
    InitializeCommonEvent(1, 90005200, 30130302, 30000, 20000, 30132302, 1053609165, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005250, 30130307, 30132307, 0, -1);
    InitializeCommonEvent(0, 90005250, 30130308, 30132308, 0, 3004);
    InitializeCommonEvent(0, 90005250, 30130309, 30132309, 0, 0);
    InitializeCommonEvent(0, 90005261, 30130315, 30132315, 1084227584, 0, 0);
    InitializeCommonEvent(0, 90005250, 30130312, 30132312, 0, 0);
    InitializeCommonEvent(0, 90005200, 30130316, 30010, 20010, 30132316, 1084227584, 0, 0, 0, 0);
    InitializeCommonEvent(1, 90005200, 30130317, 30003, 20003, 30132317, 1073741824, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005250, 30130318, 30132318, 0, 3006);
    InitializeCommonEvent(0, 90005251, 30130320, 1082130432, 0, 0);
    InitializeCommonEvent(0, 90005650, 30130540, 30131540, 30131541, 30133541, 27115);
    InitializeCommonEvent(0, 90005651, 30130540, 30131540);
    InitializeCommonEvent(0, 90005501, 30130510, 30131510, 0, 30131510, 30131511, 30131512, 30130511);
    InitializeEvent(0, 30132510, 0);
    InitializeCommonEvent(0, 90005525, 30130570, 30131570);
    InitializeEvent(0, 30132580, 0);
    InitializeEvent(0, 30132800, 0);
    InitializeEvent(0, 30132810, 0);
    InitializeEvent(0, 30132849, 0);
    InitializeEvent(0, 30132811, 0);
    InitializeCommonEvent(0, 90005200, 30130292, 30000, 20000, 30132800, 1065353216, 0, 0, 0, 0);
    InitializeCommonEvent(1, 90005200, 30130293, 30000, 20000, 30132800, 1067030938, 0, 0, 0, 0);
    InitializeCommonEvent(2, 90005200, 30130298, 30000, 20000, 30132800, 1061997773, 0, 0, 0, 0);
    InitializeCommonEvent(3, 90005200, 30130299, 30000, 20000, 30132800, 1069547520, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005646, 30130800, 30132840, 30132841, 30131840, 30132840, 3358);
    InitializeEvent(0, 30130790, 30131520, 30130800);
    InitializeEvent(0, 30132200, 30131200, 30131201, 30132350, 30132211, 30131200, 30133200);
    InitializeEvent(0, 30132205, 30131200, 30132350);
    InitializeEvent(1, 30132200, 30131201, 30131200, 30132351, 30132210, 30131201, 30133201);
    InitializeEvent(1, 30132205, 30131201, 30132351);
    InitializeEvent(2, 30132200, 30131202, 30131203, 30132352, 30132213, 30131202, 30133202);
    InitializeEvent(2, 30132205, 30131202, 30132352);
    InitializeEvent(3, 30132200, 30131203, 30131202, 30132353, 30132212, 30131203, 30133203);
    InitializeEvent(3, 30132205, 30131203, 30132353);
    InitializeEvent(4, 30132200, 30131204, 30131205, 30132354, 30132215, 30131204, 30133204);
    InitializeEvent(4, 30132205, 30131204, 30132354);
    InitializeEvent(5, 30132200, 30131205, 30131204, 30132355, 30132214, 30131205, 30133205);
    InitializeEvent(5, 30132205, 30131205, 30132355);
    InitializeEvent(6, 30132200, 30131206, 30131207, 30132356, 30132217, 30131206, 30133206);
    InitializeEvent(6, 30132205, 30131206, 30132356);
    InitializeEvent(7, 30132200, 30131207, 30131206, 30132357, 30132216, 30131207, 30133207);
    InitializeEvent(7, 30132205, 30131207, 30132357);
    InitializeEvent(8, 30132200, 30131208, 30131209, 30132358, 30132219, 30131208, 30133208);
    InitializeEvent(8, 30132205, 30131208, 30132358);
    InitializeEvent(9, 30132200, 30131209, 30131208, 30132359, 30132218, 30131209, 30133209);
    InitializeEvent(9, 30132205, 30131209, 30132359);
    InitializeEvent(10, 30132200, 30131220, 30131221, 30132280, 30132231, 30131220, 30133220);
    InitializeEvent(10, 30132205, 30131220, 30132280);
    InitializeEvent(11, 30132200, 30131221, 30131220, 30132281, 30132230, 30131221, 30133221);
    InitializeEvent(11, 30132205, 30131221, 30132281);
});

$Event(50, Default, function() {
    InitializeEvent(0, 30130519, 0);
});

$Event(30132510, Default, function() {
    InitializeCommonEvent(0, 90005500, 30130510, 30131510, 0, 30131510, 30131511, 30133511, 30131512, 30133512, 30132511, 30132512, 30130511, 30132512, 0);
});

$Event(30132580, Default, function() {
    RegisterLadder(30130580, 30130581, 30131580);
    RegisterLadder(30130582, 30130583, 30131582);
});

$Event(30132200, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4, X20_4) {
    if (!EventFlag(X16_4)) {
        WaitFor(ObjActEventFlag(X20_4));
        SetNetworkconnectedEventFlagID(X16_4, ON);
        DisableObjAct(X4_4, -1);
        DisableNetworkSync();
        WaitFixedTimeSeconds(1.3);
        WaitFixedTimeSeconds(0.9);
        if (CharacterHPValue(10000) != 0) {
            GotoIf(L20, !CharacterHasSpEffect(10000, 4170));
            GotoIf(L20, !InArea(10000, X8_4));
            FadeToBlack(0, 0, true, -1);
            DisplayGenericDialog(20700, PromptType.YESNO, NumberofOptions.NoButtons, 0, 5);
            WaitFixedTimeSeconds(0.7);
            SetSpEffect(10000, 4090);
            PlaySE(10000, SoundType.CharacterMotion, 8700);
            WaitFixedTimeSeconds(2.7);
            GotoIf(L18, CharacterHPValue(10000) == 0);
            DisableCharacter(10000);
            WarpCharacterAndCopyFloorWithFadeout(10000, TargetEntityType.Area, X12_4, -1, 10000, false, true);
            WaitFixedTimeSeconds(1);
            SetSpEffect(10000, 4091);
            EnableCharacter(10000);
            ForceAnimationPlayback(10000, 60131, false, false, false);
            FadeToBlack(0, 0, false, -1);
        } else {
L20:
            WaitFixedTimeSeconds(3.4);
L18:
            WaitFixedTimeSeconds(1);
        }
L19:
        ForceAnimationPlayback(X0_4, 2, false, true, false);
        SetNetworkconnectedEventFlagID(X16_4, OFF);
        EnableNetworkSync();
        EnableObjAct(X0_4, -1);
        EnableObjAct(X4_4, -1);
        RestartEvent();
    }
L0:
    ReproduceAssetAnimation(X0_4, 2);
    SetNetworkconnectedEventFlagID(X16_4, OFF);
    EnableObjAct(X0_4, -1);
    EnableObjAct(X4_4, -1);
    EnableNetworkSync();
    RestartEvent();
});

$Event(30132205, Restart, function(X0_4, X4_4) {
    if (!CharacterHasSpEffect(10000, 4170)) {
        WaitFor(
            EventFlag(X0_4)
                && (CharacterType(10000, TargetType.BlackPhantom)
                    || CharacterType(10000, TargetType.Alive)
                    || CharacterType(10000, TargetType.GrayPhantom)
                    || CharacterType(10000, TargetType.WhitePhantom))
                && InArea(10000, X4_4));
        SetSpEffect(10000, 4170);
        WaitFixedTimeSeconds(2.3);
    }
L0:
    SetSpEffect(10000, 4171);
    ClearSpEffect(10000, 4170);
    RestartEvent();
});

$Event(30130519, Default, function() {
    EndIf(EventFlag(30130519));
    SetEventFlagID(30130510, ON);
});

$Event(30130790, Restart, function(X0_4, X4_4) {
    EndIf(ThisEventSlot());
    DisableObjAct(X0_4, -1);
    if (EventFlag(X4_4)) {
        EnableObjAct(X0_4, -1);
        EndEvent();
    }
L0:
    WaitFor(PlayerIsInOwnWorld() && EventFlag(X4_4) && !ThisEventSlot());
    SetThisEventSlot(ON);
    EnableObjAct(X0_4, -1);
    EndEvent();
});

$Event(30132800, Restart, function() {
    EndIf(EventFlag(30130800));
    WaitFor(CharacterHPValue(30130800) <= 0);
    WaitFixedTimeSeconds(4);
    PlaySE(30130800, SoundType.SFX, 888880000);
    WaitFor(CharacterDead(30130800));
    HandleBossDefeatAndDisplayBanner(30130800, TextBannerType.EnemyFelled);
    ForceCharacterDeath(30130292, true);
    ForceCharacterDeath(30130293, true);
    ForceCharacterDeath(30130298, true);
    ForceCharacterDeath(30130299, true);
    WaitFixedTimeSeconds(6);
    WarpPlayer(11, 10, 0, 0, 11102021, -11100);
});

$Event(30132802, Restart, function() {
    EndIf(EventFlag(30130810));
    WaitFor(CharacterHPValue(30130810) <= 0);
    WaitFixedTimeSeconds(4);
    PlaySE(30130810, SoundType.SFX, 888880000);
    WaitFor(CharacterDead(30130810));
    HandleBossDefeatAndDisplayBanner(30130810, TextBannerType.GreatEnemyFelled);
    SetEventFlagID(30130810, ON);
});

$Event(30132810, Restart, function() {
    if (EventFlag(30130800)) {
        DisableCharacter(30130800);
        DisableCharacterCollision(30130800);
        ForceCharacterDeath(30130800, false);
        DisableCharacter(30130292);
        DisableCharacterCollision(30130292);
        ForceCharacterDeath(30130292, false);
        DisableCharacter(30130293);
        DisableCharacterCollision(30130293);
        ForceCharacterDeath(30130293, false);
        DisableCharacter(30130298);
        DisableCharacterCollision(30130298);
        ForceCharacterDeath(30130298, false);
        DisableCharacter(30130299);
        DisableCharacterCollision(30130299);
        ForceCharacterDeath(30130299, false);
        EndEvent();
    }
L0:
    DisableCharacterAI(30130800);
    WaitFor(EventFlag(30132805) && InArea(10000, 30132800));
L2:
    EnableCharacterAI(30130800);
    SetNetworkUpdateRate(30130800, true, CharacterUpdateFrequency.AlwaysUpdate);
    DisplayBossHealthBar(Enabled, 30130800, 0, 903400301);
});

$Event(30132811, Restart, function() {
    EndIf(EventFlag(30130800));
    WaitFor(HPRatio(30130800) <= 0.6);
    SetEventFlagID(30132802, ON);
});

$Event(30132812, Restart, function() {
    if (EventFlag(30130810)) {
        DisableCharacter(30130810);
        DisableCharacterCollision(30130810);
        ForceCharacterDeath(30130810, false);
        EndEvent();
    }
L0:
    DisableCharacterAI(30130810);
    WaitFor(EventFlag(30132815) && InArea(10000, 30132810));
L2:
    EnableCharacterAI(30130810);
    SetNetworkUpdateRate(30130800, true, CharacterUpdateFrequency.AlwaysUpdate);
    DisplayBossHealthBar(Enabled, 30130810, 0, 0);
});

$Event(30132849, Restart, function() {
    InitializeCommonEvent(0, 9005800, 30130800, 30131800, 30132800, 30132805, 30135800, 10000, 0, 0);
    InitializeCommonEvent(0, 9005801, 30130800, 30131800, 30132800, 30132805, 30132806, 10000);
    InitializeCommonEvent(0, 9005811, 30130800, 30131800, 3, 0);
    InitializeCommonEvent(0, 9005822, 30130800, 900000, 30132805, 30132806, 0, 30132802, 0, 0);
});

$Event(30132850, Restart, function() {
    InitializeCommonEvent(0, 9005800, 30130810, 30131810, 30132810, 30132815, 30135810, 10000, 0, 0);
    InitializeCommonEvent(0, 9005801, 30130810, 30131810, 30132810, 30132815, 30132816, 10000);
    InitializeCommonEvent(0, 9005811, 30130810, 30131810, 3, 0);
    InitializeCommonEvent(0, 9005822, 30130810, 930000, 30132815, 30132816, 0, 11002852, 0, 0);
});


