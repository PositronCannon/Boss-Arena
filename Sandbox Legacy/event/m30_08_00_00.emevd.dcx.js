// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common_func.emevd\u0000N:\\GR\\data\\Param\\event\\common_macro.emevd\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0,82]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    
    InitializeCommonEvent(0, 90005646, 30080800, 30082840, 30082841, 30081840, 30082840, 2078);
    RegisterBonfire(73008, 30081950, 0, 0, 0, 5);
    InitializeCommonEvent(0, 90005620, 30080575, 30081575, 30081576, 0, 30082575, 30082576, 30082577);
    InitializeCommonEvent(0, 90005621, 30080575, 30081578);
    InitializeCommonEvent(0, 90005620, 30080565, 30081565, 30081566, 0, 30082565, 30082566, 30082567);
    InitializeEvent(0, 30082564, 30080565, 30081568);
    InitializeEvent(0, 30082400, 30080300);
    InitializeEvent(1, 30082400, 30080301);
    InitializeEvent(2, 30082400, 30080302);
    InitializeCommonEvent(0, 90005261, 30080300, 30082312, 1084227584, 0, -1);
    InitializeCommonEvent(0, 90005211, 30080301, 30002, 20002, 30082210, 1092616192, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005261, 30080303, 30082303, 1073741824, 0, 0);
    InitializeCommonEvent(1, 90005261, 30080304, 30082303, 1073741824, 0, 0);
    InitializeCommonEvent(2, 90005261, 30080305, 30082303, 1073741824, 0, 0);
    InitializeCommonEvent(3, 90005261, 30080306, 30082303, 1073741824, 0, 0);
    InitializeEvent(4, 30082400, 30080303);
    InitializeEvent(5, 30082400, 30080304);
    InitializeEvent(6, 30082400, 30080305);
    InitializeEvent(7, 30082400, 30080306);
    InitializeCommonEvent(0, 90005261, 30080307, 30082307, 1073741824, 1061997773, -1);
    InitializeCommonEvent(1, 90005261, 30080308, 30082307, 1073741824, 1086953882, -1);
    InitializeCommonEvent(2, 90005261, 30080309, 30082307, 1073741824, 1056964608, -1);
    InitializeCommonEvent(3, 90005261, 30080310, 30082307, 1073741824, 1082759578, -1);
    InitializeEvent(8, 30082400, 30080307);
    InitializeEvent(9, 30082400, 30080308);
    InitializeEvent(10, 30082400, 30080309);
    InitializeEvent(11, 30082400, 30080310);
    InitializeEvent(12, 30082400, 30080450);
    InitializeCommonEvent(0, 90005300, 30080450, 30080450, 0, 1077936128, 0);
    InitializeCommonEvent(0, 90005250, 30080403, 30082403, 0, 3022);
    InitializeCommonEvent(1, 90005250, 30080404, 30082403, 1063675494, 3022);
    InitializeCommonEvent(2, 90005250, 30080405, 30082403, 1056964608, 3022);
    InitializeCommonEvent(0, 90005251, 30080406, 1082130432, 0, 0);
    InitializeCommonEvent(0, 90005250, 30080400, 30082400, 0, 3022);
    InitializeCommonEvent(0, 90005261, 30080409, 30082409, 1092616192, 0, 3022);
    InitializeCommonEvent(1, 90005250, 30080410, 30082410, 0, 3022);
    InitializeCommonEvent(0, 90005261, 30080412, 30082412, 1084227584, 0, -1);
    InitializeEvent(0, 30082300, 30080412);
    InitializeCommonEvent(0, 90005261, 30080200, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(1, 90005261, 30080201, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(2, 90005261, 30080202, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(3, 90005261, 30080203, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(4, 90005261, 30080204, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(5, 90005261, 30080205, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(6, 90005261, 30080206, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(7, 90005261, 30080207, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(8, 90005261, 30080208, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(9, 90005261, 30080209, 30082200, 1084227584, 0, 0);
    InitializeCommonEvent(0, 90005261, 30080220, 30082220, 1084227584, 0, 3035);
    InitializeCommonEvent(1, 90005261, 30080221, 30082220, 1084227584, 1065353216, 3035);
    InitializeCommonEvent(0, 90005251, 30080213, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005251, 30080214, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 30080225, 30082225, 1084227584, 0, 3035);
    InitializeCommonEvent(0, 90005251, 30080414, 1088421888, 0, 0);
    InitializeEvent(0, 30082550, 0);
    InitializeEvent(0, 30082501, 0);
    InitializeCommonEvent(0, 90005200, 30080461, 30000, 20000, 30082461, 1050253722, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005200, 30080462, 30000, 20000, 30082462, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005652, 30080540, 30081540, 30080400);
    InitializeCommonEvent(0, 90005651, 30080540, 30081540);
    InitializeEvent(0, 30082401, 0);
    InitializeEvent(0, 30082500, 0);
    InitializeCommonEvent(0, 90005501, 30080510, 30081510, 3, 30081510, 30081511, 30081512, 30080511);
    InitializeCommonEvent(0, 90005513, 30080542, 30081542, 30081543, 30083543, 27115, 0, 0);
    InitializeEvent(0, 30082510, 0);
    InitializeEvent(0, 30082580, 0);
    InitializeEvent(0, 30080520, 0);
    InitializeCommonEvent(0, 90005525, 30080570, 30081570);
    InitializeEvent(0, 30080790, 30081520, 30080800);
    InitializeEvent(0, 30082800, 0);
    InitializeEvent(0, 30082810, 0);
    InitializeEvent(0, 30082849, 0);
    InitializeEvent(0, 30082811, 0);
});

$Event(50, Default, function() {
    InitializeEvent(0, 30080519, 0);
});

$Event(30082300, Restart, function(X0_4) {
    WaitFor(CharacterAIState(X0_4, AIStateType.Combat));
    ForceAnimationPlayback(X0_4, 3009, true, false, true);
    WaitFixedTimeSeconds(2);
    ForceAnimationPlayback(X0_4, 3012, true, false, true);
    EndEvent();
});

$Event(30082400, Restart, function(X0_4) {
    if (!(CharacterDead(X0_4) || ThisEventSlot())) {
        SetSpEffect(X0_4, 5880);
        SetSpEffect(X0_4, 4320);
        DisableCharacterCollision(X0_4);
        WaitFor(InArea(X0_4, 30082300) || InArea(X0_4, 30082301) || InArea(X0_4, 30082302));
        SetThisEventSlot(ON);
        SetSpEffect(X0_4, 5881);
        SetSpEffect(X0_4, 4321);
        EnableCharacterCollision(X0_4);
        EndEvent();
    }
L0:
    SetSpEffect(X0_4, 5882);
    ClearSpEffect(X0_4, 5880);
    SetSpEffect(X0_4, 4321);
    EnableCharacterCollision(X0_4);
    EndEvent();
});

$Event(30082401, Restart, function() {
    EndIf(EventFlag(30080400));
    WaitFor(CharacterDead(30080450));
    SetEventFlagID(30080400, ON);
    EndEvent();
});

$Event(30082500, Default, function() {
    if (EventFlag(57)) {
        InitializeCommonEvent(0, 90005675, 30082500, 30083500, 30081500, 30082500, 801203070, 1082130432, 1);
    }
    if (EventFlag(56)) {
        InitializeCommonEvent(0, 90005675, 30082500, 30083500, 30081500, 30082500, 801203060, 1082130432, 1);
    }
    if (EventFlag(55)) {
        InitializeCommonEvent(0, 90005675, 30082500, 30083500, 30081500, 30082500, 801203050, 1082130432, 1);
    }
    if (EventFlag(54)) {
        InitializeCommonEvent(0, 90005675, 30082500, 30083500, 30081500, 30082500, 801203040, 1082130432, 1);
    }
    if (EventFlag(53)) {
        InitializeCommonEvent(0, 90005675, 30082500, 30083500, 30081500, 30082500, 801203030, 1082130432, 1);
    }
    if (EventFlag(52)) {
        InitializeCommonEvent(0, 90005675, 30082500, 30083500, 30081500, 30082500, 801203020, 1082130432, 1);
    }
    if (EventFlag(51)) {
        InitializeCommonEvent(0, 90005675, 30082500, 30083500, 30081500, 30082500, 801203010, 1082130432, 1);
    }
    if (EventFlag(50)) {
        InitializeCommonEvent(0, 90005675, 30082500, 30083500, 30081500, 30082500, 801203000, 1082130432, 1);
    }
    if (EventFlag(57)) {
        InitializeCommonEvent(0, 90005675, 30082501, 30083501, 30081501, 30082500, 801203070, 1073741824, 1);
    }
    if (EventFlag(56)) {
        InitializeCommonEvent(0, 90005675, 30082501, 30083501, 30081501, 30082500, 801203060, 1073741824, 1);
    }
    if (EventFlag(55)) {
        InitializeCommonEvent(0, 90005675, 30082501, 30083501, 30081501, 30082500, 801203050, 1073741824, 1);
    }
    if (EventFlag(54)) {
        InitializeCommonEvent(0, 90005675, 30082501, 30083501, 30081501, 30082500, 801203040, 1073741824, 1);
    }
    if (EventFlag(53)) {
        InitializeCommonEvent(0, 90005675, 30082501, 30083501, 30081501, 30082500, 801203030, 1073741824, 1);
    }
    if (EventFlag(52)) {
        InitializeCommonEvent(0, 90005675, 30082501, 30083501, 30081501, 30082500, 801203020, 1073741824, 1);
    }
    if (EventFlag(51)) {
        InitializeCommonEvent(0, 90005675, 30082501, 30083501, 30081501, 30082500, 801203010, 1073741824, 1);
    }
    if (EventFlag(50)) {
        InitializeCommonEvent(0, 90005675, 30082501, 30083501, 30081501, 30082500, 801203000, 1073741824, 1);
    }
    if (EventFlag(57)) {
        InitializeCommonEvent(0, 90005675, 30082502, 30083502, 30081502, 30082500, 801203070, 0, 1);
    }
    if (EventFlag(56)) {
        InitializeCommonEvent(0, 90005675, 30082502, 30083502, 30081502, 30082500, 801203060, 0, 1);
    }
    if (EventFlag(55)) {
        InitializeCommonEvent(0, 90005675, 30082502, 30083502, 30081502, 30082500, 801203050, 0, 1);
    }
    if (EventFlag(54)) {
        InitializeCommonEvent(0, 90005675, 30082502, 30083502, 30081502, 30082500, 801203040, 0, 1);
    }
    if (EventFlag(53)) {
        InitializeCommonEvent(0, 90005675, 30082502, 30083502, 30081502, 30082500, 801203030, 0, 1);
    }
    if (EventFlag(52)) {
        InitializeCommonEvent(0, 90005675, 30082502, 30083502, 30081502, 30082500, 801203020, 0, 1);
    }
    if (EventFlag(51)) {
        InitializeCommonEvent(0, 90005675, 30082502, 30083502, 30081502, 30082500, 801203010, 0, 1);
    }
    if (EventFlag(50)) {
        InitializeCommonEvent(0, 90005675, 30082502, 30083502, 30081502, 30082500, 801203000, 0, 1);
    }
    if (EventFlag(57)) {
        InitializeCommonEvent(0, 90005675, 30082503, 30083503, 30081503, 30082500, 801203070, 1083179008, 1);
    }
    if (EventFlag(56)) {
        InitializeCommonEvent(0, 90005675, 30082503, 30083503, 30081503, 30082500, 801203060, 1083179008, 1);
    }
    if (EventFlag(55)) {
        InitializeCommonEvent(0, 90005675, 30082503, 30083503, 30081503, 30082500, 801203050, 1083179008, 1);
    }
    if (EventFlag(54)) {
        InitializeCommonEvent(0, 90005675, 30082503, 30083503, 30081503, 30082500, 801203040, 1083179008, 1);
    }
    if (EventFlag(53)) {
        InitializeCommonEvent(0, 90005675, 30082503, 30083503, 30081503, 30082500, 801203030, 1083179008, 1);
    }
    if (EventFlag(52)) {
        InitializeCommonEvent(0, 90005675, 30082503, 30083503, 30081503, 30082500, 801203020, 1083179008, 1);
    }
    if (EventFlag(51)) {
        InitializeCommonEvent(0, 90005675, 30082503, 30083503, 30081503, 30082500, 801203010, 1083179008, 1);
    }
    if (EventFlag(50)) {
        InitializeCommonEvent(0, 90005675, 30082503, 30083503, 30081503, 30082500, 801203000, 1083179008, 1);
    }
    if (EventFlag(57)) {
        InitializeCommonEvent(0, 90005675, 30082504, 30083504, 30081504, 30082500, 801203070, 1073741824, 1);
    }
    if (EventFlag(56)) {
        InitializeCommonEvent(0, 90005675, 30082504, 30083504, 30081504, 30082500, 801203060, 1073741824, 1);
    }
    if (EventFlag(55)) {
        InitializeCommonEvent(0, 90005675, 30082504, 30083504, 30081504, 30082500, 801203050, 1073741824, 1);
    }
    if (EventFlag(54)) {
        InitializeCommonEvent(0, 90005675, 30082504, 30083504, 30081504, 30082500, 801203040, 1073741824, 1);
    }
    if (EventFlag(53)) {
        InitializeCommonEvent(0, 90005675, 30082504, 30083504, 30081504, 30082500, 801203030, 1073741824, 1);
    }
    if (EventFlag(52)) {
        InitializeCommonEvent(0, 90005675, 30082504, 30083504, 30081504, 30082500, 801203020, 1073741824, 1);
    }
    if (EventFlag(51)) {
        InitializeCommonEvent(0, 90005675, 30082504, 30083504, 30081504, 30082500, 801203010, 1073741824, 1);
    }
    if (EventFlag(50)) {
        InitializeCommonEvent(0, 90005675, 30082504, 30083504, 30081504, 30082500, 801203000, 1073741824, 1);
    }
    if (EventFlag(57)) {
        InitializeCommonEvent(0, 90005675, 30082505, 30083505, 30081505, 30082500, 801203070, 0, 1);
    }
    if (EventFlag(56)) {
        InitializeCommonEvent(0, 90005675, 30082505, 30083505, 30081505, 30082500, 801203060, 0, 1);
    }
    if (EventFlag(55)) {
        InitializeCommonEvent(0, 90005675, 30082505, 30083505, 30081505, 30082500, 801203050, 0, 1);
    }
    if (EventFlag(54)) {
        InitializeCommonEvent(0, 90005675, 30082505, 30083505, 30081505, 30082500, 801203040, 0, 1);
    }
    if (EventFlag(53)) {
        InitializeCommonEvent(0, 90005675, 30082505, 30083505, 30081505, 30082500, 801203030, 0, 1);
    }
    if (EventFlag(52)) {
        InitializeCommonEvent(0, 90005675, 30082505, 30083505, 30081505, 30082500, 801203020, 0, 1);
    }
    if (EventFlag(51)) {
        InitializeCommonEvent(0, 90005675, 30082505, 30083505, 30081505, 30082500, 801203010, 0, 1);
    }
    if (EventFlag(50)) {
        InitializeCommonEvent(0, 90005675, 30082505, 30083505, 30081505, 30082500, 801203000, 0, 1);
    }
});

$Event(30082510, Default, function() {
    InitializeCommonEvent(0, 90005500, 30080510, 30081510, 3, 30081510, 30081511, 30083511, 30081512, 30083512, 30082511, 30082512, 30080511, 30082512, 0);
});

$Event(30080519, Default, function() {
    EndIf(ThisEventSlot());
    SetEventFlagID(30080510, ON);
});

$Event(30080520, Restart, function() {
    EnableAssetInvunerability(30081508);
    WaitFor(
        InArea(10000, 30082508)
            && ((CharacterType(10000, TargetType.BlackPhantom) && CharacterHasSpEffect(10000, 3710))
                || CharacterType(10000, TargetType.Alive)
                || CharacterType(10000, TargetType.GrayPhantom)
                || CharacterType(10000, TargetType.WhitePhantom)));
    DisableAssetInvunerability(30081508);
    EndEvent();
});

$Event(30082564, Default, function(X0_4, X4_4) {
    if (EventFlag(X0_4)) {
        DisableAsset(X4_4);
        EndEvent();
    }
L0:
    CreateAssetfollowingSFX(X4_4, 101, 806043);
    WaitFor(PlayerIsInOwnWorld() && EventFlag(X0_4));
    DeleteAssetfollowingSFX(X4_4, true);
    PlaySE(X4_4, SoundType.SFX, 90011);
    WaitFixedTimeSeconds(0.5);
    DisableAsset(X4_4);
});

$Event(30082580, Default, function() {
    RegisterLadder(30080580, 30080581, 30081580);
});

$Event(30082550, Restart, function() {
    EndIf(EventFlag(30082500));
    WaitFor(
        InArea(10000, 30082460)
            && CharacterBackreadStatus(30080460)
            && ((CharacterType(10000, TargetType.BlackPhantom) && CharacterHasSpEffect(10000, 3710))
                || CharacterType(10000, TargetType.Alive)
                || CharacterType(10000, TargetType.GrayPhantom)
                || CharacterType(10000, TargetType.WhitePhantom)));
    SetNetworkconnectedEventFlagID(30082550, ON);
    EndEvent();
});

$Event(30082501, Restart, function() {
    if (!EventFlag(30082501)) {
        WaitFor(
            InArea(10000, 30082450)
                && CharacterBackreadStatus(30080460)
                && EventFlag(30082550)
                && ((CharacterType(10000, TargetType.BlackPhantom) && CharacterHasSpEffect(10000, 3710))
                    || CharacterType(10000, TargetType.Alive)
                    || CharacterType(10000, TargetType.GrayPhantom)
                    || CharacterType(10000, TargetType.WhitePhantom)));
        SetNetworkconnectedEventFlagID(30082501, ON);
        WaitFixedTimeSeconds(0);
    }
L0:
    InvokeEnemyGenerator(30083460);
    EnableCharacterAI(30080460);
    EndEvent();
});

$Event(30080790, Restart, function(X0_4, X4_4) {
    EndIf(ThisEventSlot());
    DisableObjAct(X0_4, -1);
    if (EventFlag(X4_4)) {
        EnableObjAct(X0_4, -1);
        EndEvent();
    }
L0:
    WaitFor(PlayerIsInOwnWorld() && EventFlag(X4_4) && !ThisEventSlot());
    SetThisEventSlot(ON);
    EnableObjAct(X0_4, -1);
    EndEvent();
});

$Event(30082800, Restart, function() {
    EndIf(EventFlag(30080800));
    WaitFor(CharacterHPValue(30080800) <= 0);
    WaitFixedTimeSeconds(4);
    PlaySE(30080800, SoundType.SFX, 888880000);
    WaitFor(CharacterDead(30080800));
    HandleBossDefeatAndDisplayBanner(30080800, TextBannerType.EnemyFelled);
    WaitFixedTimeSeconds(6);
    WarpPlayer(11, 10, 0, 0, 11102021, -11100);
});

$Event(30082810, Restart, function() {
    if (EventFlag(30080800)) {
        DisableCharacter(30080800);
        DisableCharacterCollision(30080800);
        ForceCharacterDeath(30080800, false);
        EndEvent();
    }
L0:
    DisableCharacterAI(30080800);
    WaitFor(EventFlag(30082805) && InArea(10000, 30082800));
L2:
    EnableCharacterAI(30080800);
    SetNetworkUpdateRate(30080800, true, CharacterUpdateFrequency.AlwaysUpdate);
    DisplayBossHealthBar(Enabled, 30080800, 0, 907100300);
});

$Event(30082811, Restart, function() {
    EndIf(EventFlag(30080800));
    WaitFor(HPRatio(30080800) <= 0.6);
    SetEventFlagID(30082802, ON);
});

$Event(30082849, Restart, function() {
    InitializeCommonEvent(0, 9005800, 30080800, 30081800, 30082800, 30082805, 30085800, 10000, 0, 0);
    InitializeCommonEvent(0, 9005801, 30080800, 30081800, 30082800, 30082805, 30082806, 10000);
    InitializeCommonEvent(0, 9005811, 30080800, 30081800, 3, 0);
    InitializeCommonEvent(0, 9005822, 30080800, 920200, 30082805, 30082806, 0, 30082802, 0, 0);
});


