// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common_func.emevd\u0000N:\\GR\\data\\Param\\event\\common_macro.emevd\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0,82]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    RegisterBonfire(1047580000, 1047581950, 0, 0, 0, 5);
    InitializeEvent(0, 1047583500, 1047582710);
    InitializeEvent(0, 1047583700, 1047580705, 1047580710, 1047581701);
    InitializeEvent(0, 1047583701, 1047580705, 1047581700);
    InitializeEvent(0, 1047583702, 1047580705);
    InitializeEvent(0, 1047583703, 1047580705);
    InitializeEvent(0, 1047583704, 1047580705);
    InitializeCommonEvent(0, 90005750, 1047581701, 4350, 104110, 400411, 400411, 1047589210, 0);
    InitializeCommonEvent(0, 90005708, 1047580710, 6001, 0);
});

$Event(200, Default, function() {
    InitializeCommonEvent(0, 90005451, 1247580400, 1247586420);
    InitializeCommonEvent(0, 90005452, 1247580400, 1247580400);
    InitializeCommonEvent(0, 90005454, 1247580400, 1247582400, 1247580400);
    InitializeCommonEvent(0, 90005458, 1247580400, 1247581401);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581420, 101, 0);
    InitializeCommonEvent(1, 90005453, 1247580400, 1247581421, 102, 1036831949);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581422, 103, 1045220557);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581423, 104, 1050253722);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581424, 105, 1053609165);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581425, 106, 1056964608);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581426, 107, 1058642330);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581427, 108, 1060320051);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581428, 109, 1061997773);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581429, 110, 1063675494);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581430, 111, 1065353216);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581436, 117, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581437, 118, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581438, 119, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581439, 120, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581440, 121, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581441, 122, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581442, 123, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581443, 124, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581444, 125, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581445, 126, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581446, 127, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581447, 128, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581452, 133, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581453, 134, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581454, 135, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581455, 136, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581456, 137, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581457, 138, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581458, 139, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581459, 140, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581460, 141, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581461, 142, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581468, 149, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581469, 150, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581470, 151, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581471, 152, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581472, 153, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581473, 154, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581474, 155, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581475, 156, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581476, 157, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581477, 158, 0);
    InitializeCommonEvent(0, 90005453, 1247580400, 1247581478, 159, 0);
    InitializeCommonEvent(0, 90005456, 1247580400, 1247581410, 1247581418, 1247580400);
    InitializeEvent(0, 1247582350, 1247580400, 1247582400);
});

$Event(50, Default, function() {
    SetCharacterBackreadState(1047580700, true);
    SetCharacterBackreadState(1047580705, true);
});

$Event(1047583500, Restart, function(X0_4) {
    DisableNetworkSync();
    WaitFor(InArea(20000, X0_4) && !HasMultiplayerState(MultiplayerState.Invasion));
    SetSpEffect(20000, 9621);
    WaitFixedTimeSeconds(0.1);
    WaitFor(!InArea(20000, X0_4) || HasMultiplayerState(MultiplayerState.Invasion));
    WaitFixedTimeSeconds(0.1);
    ClearSpEffect(20000, 9621);
    RestartEvent();
});

$Event(1047583700, Restart, function(X0_4, X4_4, X8_4) {
    WaitFixedTimeFrames(1);
    DisableNetworkSync();
    SetCharacterBackreadState(X4_4, false);
    EnableCharacter(X4_4);
    SetCharacterMaphit(X4_4, false);
    DisableCharacterGravity(X4_4);
    SetCharacterTeamType(X4_4, TeamType.Disabled);
    ForceAnimationPlayback(X4_4, 930009, false, false, false);
    WarpAssetToCharacter(X8_4, X0_4, -1);
    if (PlayerIsInOwnWorld()) {
        if (EventFlag(4100)) {
            SetEventFlagID(1036419203, OFF);
        }
    }
L10:
    if (!EventFlag(4106)) {
        DisableCharacter(X0_4);
        SetCharacterBackreadState(X0_4, true);
        WaitFor(EventFlag(4106));
        RestartEvent();
    }
L5:
    GotoIf(L1, EventFlag(4100));
    GotoIf(L2, EventFlag(4101));
    GotoIf(L3, EventFlag(4102));
    GotoIf(L4, EventFlag(4103));
L1:
    SetCharacterBackreadState(X0_4, false);
    DisableCharacter(X0_4);
    SetCharacterTeamType(X0_4, TeamType.Disabled);
    ForceAnimationPlayback(X0_4, 930011, false, false, false);
    if (EventFlag(1047582700)) {
        EnableCharacter(X0_4);
    }
    if (EventFlag(1047582701)) {
        ForceAnimationPlayback(X0_4, 930013, false, false, false);
    }
    if (EventFlag(1047589205)) {
        SetCharacterBackreadState(X0_4, true);
        DisableCharacter(X0_4);
    }
    GotoIf(L20, mainGroupAbuse);
L2:
    SetCharacterBackreadState(X0_4, false);
    EnableCharacter(X0_4);
    Goto(L20);
L3:
    SetCharacterBackreadState(X0_4, false);
    EnableCharacter(X0_4);
    Goto(L20);
L4:
    ForceCharacterTreasure(X0_4);
    DisableCharacter(X0_4);
    SetCharacterBackreadState(X0_4, true);
    Goto(L20);
L20:
    WaitFor(!EventFlag(4106));
    RestartEvent();
});

$Event(1047583701, Restart, function(X0_4, X4_4) {
    WaitFixedTimeFrames(1);
    EndIf(!EventFlag(4100));
    EndIf(!EventFlag(4106));
    EndIf(EventFlag(1047589205));
    EndIf(EventFlag(1047582700));
    if (!PlayerIsInOwnWorld()) {
        WaitFor(EventFlag(1047582700));
    } else {
        WaitFor(ActionButtonInArea(6340, X4_4) && PlayerIsInOwnWorld());
        ForceAnimationPlayback(10000, 90008, false, false, false);
        SetNetworkconnectedEventFlagID(1047582700, ON);
    }
L1:
    WaitFixedTimeSeconds(1.5);
    EnableCharacter(X0_4);
    ForceAnimationPlayback(X0_4, 20025, false, false, false);
    EndEvent();
});

$Event(1047583702, Restart, function(X0_4) {
    WaitFixedTimeFrames(1);
    EndIf(!EventFlag(4100));
    EndIf(!EventFlag(4106));
    EndIf(EventFlag(1047589205));
    WaitFor(EventFlag(1047589205));
    WaitFixedTimeSeconds(30);
    DisableCharacter(X0_4);
    SetCharacterBackreadState(X0_4, true);
    EndEvent();
});

$Event(1047583703, Restart, function(X0_4) {
    EndIf(!PlayerIsInOwnWorld());
    WaitFixedTimeFrames(1);
    EndIf(!EventFlag(4100));
    EndIf(!EventFlag(4106));
    EndIf(EventFlag(1047589210));
    if (!EventFlag(1047589205)) {
        WaitFor(CharacterHasSpEffect(X0_4, 9600));
    }
    SetEventFlagID(1047589210, ON);
    EndEvent();
});

$Event(1047583704, Restart, function(X0_4) {
    EndIf(!PlayerIsInOwnWorld());
    EndIf(!EventFlag(4100));
    EndIf(!EventFlag(4106));
    EndIf(EventFlag(1047589205));
    EndIf(EventFlag(1047582700));
    WaitFor(EventFlag(1047582701));
    WaitFixedTimeSeconds(3.5);
    ForceAnimationPlayback(X0_4, 20019, false, false, false);
    EndEvent();
});

$Event(250, Default, function() {
    InitializeCommonEvent(0, 90005450, 1247580400, 1247581400, 1247581410, 1247581418);
});

$Event(1247582350, Restart, function(X0_4, X4_4) {
    EndIf(EventFlag(1247580400));
    WaitFor(
        ((CharacterType(10000, TargetType.BlackPhantom) && CharacterHasSpEffect(10000, 3710))
            || CharacterType(10000, TargetType.Alive)
            || CharacterType(10000, TargetType.GrayPhantom)
            || CharacterType(10000, TargetType.WhitePhantom))
            && (InArea(10000, X4_4) || EntityInRadiusOfEntity(10000, X0_4, 10, 1)));
    EndIf(EventFlag(1247580400));
    RequestCharacterAICommand(X0_4, 10, 0);
    SetEventFlagID(1247582350, ON);
    WaitFixedTimeSeconds(9);
    RequestCharacterAICommand(X0_4, -1, 0);
    RequestCharacterAIReplan(X0_4);
    WaitFixedTimeSeconds(1);
    RestartEvent();
});
