// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common_func.emevd\u0000N:\\GR\\data\\Param\\event\\common_macro.emevd\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0,82]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    RegisterBonfire(31040000, 31041950, 0, 0, 0, 5);
    InitializeEvent(0, 31042800, 0);
    InitializeEvent(0, 31042810, 0);
    InitializeEvent(0, 31042849, 0);
    InitializeEvent(0, 31042811, 0);
    InitializeCommonEvent(0, 90005646, 31040800, 31042840, 31042841, 31041840, 31042840, 1055);
});

$Event(50, Default, function() {
    InitializeCommonEvent(0, 90005261, 31040200, 31042200, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040205, 31042205, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040206, 31042205, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040207, 31042207, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040208, 31042207, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040209, 31042207, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040211, 31042211, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040212, 31042212, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040216, 31042216, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040217, 31042216, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005251, 31040219, 1069547520, 0, 1701);
    InitializeCommonEvent(0, 90005251, 31040220, 1069547520, 0, 1701);
    InitializeCommonEvent(0, 90005251, 31040221, 1069547520, 0, 1701);
    InitializeCommonEvent(0, 90005251, 31040222, 1069547520, 0, 1701);
    InitializeCommonEvent(0, 90005261, 31040223, 31042223, 1069547520, 0, 0);
    InitializeCommonEvent(0, 90005251, 31040219, 1069547520, 0, 1701);
    InitializeCommonEvent(0, 90005261, 31040250, 31042250, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040253, 30001, 20001, 31042207, 1073741824, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040254, 30001, 20001, 31042207, 1073741824, 1050253722, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040257, 30001, 20001, 31042257, 1073741824, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040260, 31042260, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040261, 31042260, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040262, 31042260, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040263, 31042260, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040264, 31042260, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040275, 30001, 20001, 31042275, 1073741824, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040276, 30001, 20001, 31042275, 1073741824, 1050253722, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040277, 30001, 20001, 31042275, 1073741824, 1056964608, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040278, 30001, 20001, 31042275, 1073741824, 1063675494, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040279, 30001, 20001, 31042275, 1073741824, 1060320051, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040300, 30000, 20000, 31042300, 1073741824, 1092616192, 1, 0, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040310, 31042310, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040311, 30000, 20000, 31042311, 1073741824, 0, 0, 0, 0, 0);
    InitializeCommonEvent(0, 90005261, 31040312, 31042312, 1073741824, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040318, 30000, 20000, 31042318, 1073741824, 0, 2, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040319, 30000, 20000, 31042318, 1073741824, 1050253722, 2, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040320, 30000, 20000, 31042318, 1073741824, 1056964608, 2, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040323, 30000, 20000, 31042323, 1073741824, 1084227584, 1, 0, 0, 0);
    InitializeCommonEvent(0, 90005211, 31040324, 30000, 20000, 31042323, 1073741824, 1084647014, 1, 0, 0, 0);
    InitializeEvent(0, 31042310, 31040300);
    InitializeEvent(1, 31042310, 31040310);
    InitializeEvent(2, 31042310, 31040311);
    InitializeEvent(3, 31042310, 31040312);
    InitializeEvent(4, 31042310, 31040318);
    InitializeEvent(5, 31042310, 31040319);
    InitializeEvent(6, 31042310, 31040320);
    InitializeEvent(7, 31042310, 31040323);
    InitializeEvent(8, 31042310, 31040324);
});

$Event(31042310, Restart, function(X0_4) {
    SetSpEffect(X0_4, 90000);
});

$Event(31042800, Restart, function() {
    EndIf(EventFlag(31040800));
    WaitFor(CharacterHPValue(31040800) <= 0);
    WaitFixedTimeSeconds(4);
    PlaySE(31040800, SoundType.SFX, 888880000);
    WaitFor(CharacterDead(31040800));
    HandleBossDefeatAndDisplayBanner(31040800, TextBannerType.EnemyFelled);
    //boss rewards (4 bonus items)
    InitializeCommonEvent(0,90001024,1049304135,1049304045,1049304043,-1,1049304586,1049304555,1049304556,1049304557,1049304558,1049304588,1049304591,1049304595,1049304597,1049300135);
    WaitFixedTimeSeconds(6);
    WarpPlayer(11, 10, 0, 0, 11102021, 0);
});

$Event(31042810, Restart, function() {
    if (EventFlag(31040800)) {
        DisableCharacter(31040800);
        DisableCharacterCollision(31040800);
        ForceCharacterDeath(31040800, false);
        EndEvent();
    }
L0:
    DisableCharacterAI(31040800);
    SetSpEffect(31040800, 90000);
    ForceAnimationPlayback(31040800, 30001, false, false, false);
    WaitFor(EventFlag(31042805) && InArea(10000, 31042800));
L2:
    WaitFixedTimeSeconds(1);
    ForceAnimationPlayback(31040800, 20001, false, false, false);
    EnableCharacterAI(31040800);
    SetNetworkUpdateRate(31040800, true, CharacterUpdateFrequency.AlwaysUpdate);
    DisplayBossHealthBar(Enabled, 31040800, 0, 903800310);
});

$Event(31042811, Restart, function() {
    EndIf(EventFlag(31040800));
    WaitFor(HPRatio(31040800) <= 0.6);
    SetEventFlagID(31042802, ON);
});

$Event(31042849, Restart, function() {
    InitializeCommonEvent(0, 9005800, 31040800, 31041800, 31042800, 31042805, 31045800, 10000, 0, 0);
    InitializeCommonEvent(0, 9005801, 31040800, 31041800, 31042800, 31042805, 31042806, 10000);
    InitializeCommonEvent(0, 9005811, 31040800, 31041800, 5, 0);
    InitializeCommonEvent(0, 9005822, 31040800, 931000, 31042805, 31042806, 0, 31042802, 0, 0);
});
